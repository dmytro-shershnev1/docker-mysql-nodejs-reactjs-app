apiVersion: v1
kind: Pod
metadata:
  name: users-app
spec:
  containers:
    - name: backend
      image: europe-west1-docker.pkg.dev/app-project-431616/app-docker-repo/backend-image
    - name: cloudsql-proxy
      image: gcr.io/cloudsql-docker/gce-proxy:1.16
      command: ["/cloud_sql_proxy",
                "-instances=app-project-431616:europe-west1:mysql-instance=tcp:3306",
                "-credential_file=/secrets/cloudsql/credentials.json"]
      volumeMounts:
        - name: cloudsql-instance-credentials
          mountPath: /secrets/cloudsql
          readOnly: true
  volumes:
    - name: cloudsql-instance-credentials
      secret:
        secretName: cloudsql-instance-credentials
